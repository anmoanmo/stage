# é˜¶æ®µ 0ï½œæ‰“åº•ä¸å·¥å…·é“¾ â€” å­¦ä¹ èµ„æ–™æ¸…å•ï¼ˆç²¾é€‰ï¼‰

ä¸‹é¢æŒ‰â€œå·¥å…·â†’æ–‡æ¡£â†’è§†é¢‘/å®è·µâ€ç»™ä½ ä¸€å¥—å¤Ÿç”¨ä¸è´µçš„å…¥å£ã€‚æ¯ä¸€é¡¹éƒ½ç»æŒ‘é€‰ï¼Œå°½é‡ä»¥å®˜æ–¹æ–‡æ¡£ä¸ºä¸»ï¼Œä¸­æ–‡èµ„æ–™å’Œ bilibili ä½œä¸ºè¡¥å……ã€‚

## 1) ç¼–è¯‘ä¸æ„å»ºï¼ˆGCC/Clangã€CMakeã€Makefileï¼‰

* **CMake å®˜æ–¹å…¥é—¨ & æ•™ç¨‹**ï¼šå®‰è£…ã€Presetsã€CTest å…¨åœ¨è¿™ã€‚é€‚åˆç›´æ¥ç…§ç€åšé¡¹ç›®æ¨¡æ¿ã€‚ ([valgrind.org](https://valgrind.org/docs/manual/mc-manual.html?utm_source=chatgpt.com "4. Memcheck: a memory error detector"))
* **Modern CMake æŒ‡å—**ï¼ˆHenry Schreinerï¼Œç¤¾åŒºå…¬è®¤çš„ç°ä»£å†™æ³•è®²è§£ï¼Œå«ç›®æ ‡å¯¼å‘/æ¥å£åº“ç­‰ï¼‰ï¼šé€‚åˆæŠŠè€å¼ `add_definitions` æ€ç»´æ¢æ‰ã€‚ ([man7.org](https://man7.org/linux/man-pages/man1/strace.1.html?utm_source=chatgpt.com "strace(1) - Linux manual page"))
* **Makefile ä¸­æ–‡æƒå¨æ•™ç¨‹ï¼ˆé™ˆçš“ã€Šè·Ÿæˆ‘ä¸€èµ·å†™Makefileã€‹é‡åˆ¶ç‰ˆ/åœ¨çº¿ç‰ˆï¼‰**ï¼šæ„å»ºè§„åˆ™ã€éšå¼è§„åˆ™å†™å¾—éå¸¸ç³»ç»Ÿã€‚ ([SeisMançš„é¡¹ç›®åˆ—è¡¨](https://seisman.github.io/how-to-write-makefile/overview.html "æ¦‚è¿° â€” è·Ÿæˆ‘ä¸€èµ·å†™Makefile 1.0 æ–‡æ¡£"), [GitHub](https://github.com/seisman/how-to-write-makefile "GitHub - seisman/how-to-write-makefile: è·Ÿæˆ‘ä¸€èµ·å†™Makefileé‡åˆ¶ç‰ˆ"))
* **bç«™ï¼šç°ä»£ CMake ç³»åˆ—è§†é¢‘ï¼ˆå…¥é—¨åˆ°å®æˆ˜ï¼‰**ï¼šå¯é…åˆå®˜æ–¹æ–‡æ¡£åå¤å¯¹ç…§ã€‚ ([å“”å“©å“”å“©](https://www.bilibili.com/video/BV1A7411f7jT/?utm_source=chatgpt.com "CMakeç®€æ˜æ•™ç¨‹ä»¥åŠç°ä»£CMake"), [å“”å“©å“”å“©](https://m.bilibili.com/search?keyword=cmake&utm_source=chatgpt.com "cmake-å“”å“©å“”å“©_Bilibili"))

## 2) ç‰ˆæœ¬æ§åˆ¶ï¼ˆGitï¼‰

* **Pro Gitï¼ˆå®˜æ–¹ç”µå­ä¹¦ï¼Œå«ä¸­æ–‡ï¼‰**ï¼šç³»ç»Ÿè®²è§£åˆ†æ”¯ã€å˜åŸºã€å·¥ä½œæµã€‚ ([google.github.io](https://google.github.io/benchmark/user_guide.html?utm_source=chatgpt.com "User Guide | benchmark - Google - GitHub Pages"))
* **Git å®˜æ–¹å‚è€ƒæ‰‹å†Œ**ï¼šæŸ¥å‘½ä»¤è¯­ä¹‰ç”¨ã€‚ ([GitHub](https://github.com/martinus/robin-hood-hashing?utm_source=chatgpt.com "martinus/robin-hood-hashing: Fast & memory efficient ..."))

## 3) è°ƒè¯•ä¸è¯Šæ–­ï¼ˆgdb / strace / perfï¼‰

* **gdb å®˜æ–¹æ‰‹å†Œï¼ˆç½‘é¡µç‰ˆ & PDFï¼‰**ï¼šæ–­ç‚¹ã€BTã€TUIã€åå‘è°ƒè¯•ç­‰å…¨è¦†ç›–ã€‚å»ºè®®æ”¶è— PDF æœç´¢ã€‚ ([sourceware.org](https://sourceware.org/gdb/current/onlinedocs/gdb?utm_source=chatgpt.com "Debugging with GDB"))
* **strace å®˜æ–¹ä»“åº“ README**ï¼ˆç”¨æ³•ä¸å®šä½ç³»ç»Ÿè°ƒç”¨å±‚é—®é¢˜çš„å®šä½æ€è·¯ï¼‰ã€‚ ([GitHub](https://github.com/strace/strace/blob/master/README.md?utm_source=chatgpt.com "strace/README.md at master"))
* **perf å®˜æ–¹/ç¤¾åŒºæ•™ç¨‹**ï¼š
  * Brendan Gregg çš„ perf/ç«ç„°å›¾èµ„æ–™ä¸å·¥å…·é›†ï¼ˆå…¥é—¨çœ‹æ³•é—¨ã€è¿›é˜¶çœ‹ç»†èŠ‚ï¼‰ã€‚ ([GitHub](https://github.com/marketplace/actions/ctest-action?utm_source=chatgpt.com "CTest Action - GitHub Marketplace"), [Manning Publications](https://www.manning.com/books/c-plus-plus-concurrency-in-action-second-edition?utm_source=chatgpt.com "C++ Concurrency in Action, Second Edition"))
  * å†…æ ¸ `perf_event_paranoid` æƒé™è¯´æ˜ä¸ä¿®æ”¹æ–¹æ³•ï¼ˆCI/å®¹å™¨/äº‘ä¸»æœºä¸Šå¸¸è¢«å¡ä½ï¼‰ã€‚ ([Linuxå†…æ ¸æ–‡æ¡£](https://docs.kernel.org/admin-guide/sysctl/kernel.html?utm_source=chatgpt.com "Documentation for /proc/sys/kernel"), [Linux Audit](https://linux-audit.com/kernel/sysctl/kernel/kernel.perf_event_paranoid/?utm_source=chatgpt.com "Sysctl: kernel.perf_event_paranoid - Linux Audit"), [Ask Ubuntu](https://askubuntu.com/questions/1471162/how-to-change-kernel-perf-event-paranoid-settings?utm_source=chatgpt.com "How to change kernel.perf_event_paranoid settings?"))
* **bç«™ï¼šperf + ç«ç„°å›¾ã€åŸç†ä¸å®æˆ˜æ–‡ç« /è§†é¢‘**ï¼ˆä¸­æ–‡è®²è§£ï¼Œé€‚åˆå…ˆæ„Ÿæ€§è®¤è¯†å†å›åˆ°å®˜æ–¹æ–‡æ¡£ï¼‰ã€‚ ([å“”å“©å“”å“©](https://www.bilibili.com/video/BV1hg4y1o7Sb/?utm_source=chatgpt.com "ã€ç«ç„°å›¾ğŸ”¥ã€‘Linux C/C++æ€§èƒ½ä¼˜åŒ–åˆ†æå·¥å…·Perfä½¿ç”¨æ•™ç¨‹"))

## 4) è¿è¡Œæ—¶é—®é¢˜å®šä½ï¼ˆASan / UBSan / Valgrindï¼‰

* **AddressSanitizerï¼ˆASanï¼‰å®˜æ–¹æ–‡æ¡£ï¼ˆClangï¼‰**ï¼šæœ€å¿«ä¸Šæ‰‹çš„å†…å­˜é”™è¯¯æ¢æµ‹å™¨ï¼Œå¼€å‘æœŸå¿…å¼€ã€‚ ([clang.llvm.org](https://clang.llvm.org/docs/AddressSanitizer.html?utm_source=chatgpt.com "AddressSanitizer â€” Clang 22.0.0git documentation"))
* **UBSanï¼ˆUndefinedBehaviorSanitizerï¼‰å®˜æ–¹æ–‡æ¡£ï¼ˆClangï¼‰**ï¼šæ•´æ•°æº¢å‡ºã€è¶Šç•Œã€ç©ºæŒ‡é’ˆè§£å¼•ç”¨ç­‰ UB æ£€æµ‹ã€‚ ([clang.llvm.org](https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html?utm_source=chatgpt.com "UndefinedBehaviorSanitizer â€” Clang 22.0.0git documentation"))
* **Google Sanitizers æ€»è§ˆ**ï¼šASan/LSan/TSan/MSan çš„ç»Ÿä¸€å…¥å£ã€‚ ([GitHub](https://github.com/google/sanitizers?utm_source=chatgpt.com "google/sanitizers: AddressSanitizer, ThreadSanitizer, ..."))
* **Valgrind å®˜æ–¹æ‰‹å†Œï¼ˆMemcheck/Helgrind ç­‰ï¼‰**ï¼šæ…¢ä½†å…¨é¢ï¼Œè”è°ƒå¤æ‚é—®é¢˜æ—¶å…œåº•ã€‚ ([valgrind.org](https://valgrind.org/docs/manual/manual.html?utm_source=chatgpt.com "Valgrind User Manual"))
* **bç«™ï¼šASAN ä¸ Valgrind å¯¹æ¯”è®²è§£**ï¼ˆä¸­æ–‡è§†é¢‘ï¼Œç†è§£å„è‡ªé€‚ç”¨åœºæ™¯ï¼‰ã€‚ ([å“”å“©å“”å“©](https://www.bilibili.com/video/BV1wh4y1B7MM/?utm_source=chatgpt.com "C/C++å†…å­˜æ³„æ¼æ£€æµ‹å·¥å…·ASANå’ŒValgrind"))

## 5) C++ å¹¶å‘åŸºçŸ³ï¼ˆ`std::thread/mutex/condvar/atomic`ï¼‰

* **cppreferenceï¼ˆæƒå¨é€ŸæŸ¥ï¼‰**ï¼š
  * `std::thread`ã€`std::mutex`ã€`std::condition_variable`ã€`std::atomic`ã€‚å»ºè®®é…åˆç¤ºä¾‹ä¸â€œå†…å­˜åºâ€ç« èŠ‚åå¤çœ‹ã€‚ ([LLVM Apt](https://apt.llvm.org/?utm_source=chatgpt.com "LLVM Debian/Ubuntu packages"), [Reddit](https://www.reddit.com/r/linux4noobs/comments/17ooche/what_is_buildessential_and_why_i_need_it_to/?utm_source=chatgpt.com "What is build-essential and why I need it to program in C++?"), [Ask Ubuntu](https://askubuntu.com/questions/309786/llvm-and-clang-installation-on-ubuntu?utm_source=chatgpt.com "llvm and clang installation on ubuntu"))
* **æƒå¨æ•™æ**ï¼š*C++ Concurrency in Action (2nd)*ï¼ˆAnthony Williamsï¼‰â€”â€”å·¥ç¨‹å®è·µä¸æ ‡å‡†è¯­ä¹‰è®²å¾—éå¸¸ç»†ã€‚ ([Cppreference](https://en.cppreference.com/w/cpp/thread/thread.html?utm_source=chatgpt.com "std::thread"))
* **bç«™ï¼šç”¨æ¡ä»¶å˜é‡å®ç°çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—ï¼ˆç³»åˆ—è§†é¢‘ï¼‰**ï¼šç»“åˆä»£ç æŠŠ API ä¸²èµ·æ¥ã€‚ ([å“”å“©å“”å“©](https://www.bilibili.com/video/BV1934y1N7Nb?utm_source=chatgpt.com "C++ å¹¶å‘ç¼–ç¨‹(6) åˆ©ç”¨æ¡ä»¶å˜é‡å®ç°çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—"))

## 6) å•å…ƒæµ‹è¯•ä¸åŸºå‡†ï¼ˆGoogleTest / Google Benchmarkï¼‰

* **GoogleTest å®˜æ–¹ Quickstartï¼ˆCMakeï¼‰**ï¼šä¸€æ­¥æ­¥æ‹‰èµ· gtest å¹¶ç”¨ CTest å‘ç°æµ‹è¯•ã€‚ ([google.github.io](https://google.github.io/googletest/quickstart-cmake.html?utm_source=chatgpt.com "Quickstart: Building with CMake | GoogleTest"))
* **Google Benchmark å®˜æ–¹ä»“åº“ï¼ˆUser Guide/ç¤ºä¾‹ï¼‰**ï¼šå‹æµ‹å¾®åŸºå‡†ã€å‚æ•°åŒ–ã€ç»Ÿè®¡å­¦é…ç½®ç­‰ã€‚ ([GitHub](https://github.com/google/benchmark?utm_source=chatgpt.com "google/benchmark: A microbenchmark support library"), [Chromium Git Repositories](https://chromium.googlesource.com/external/github.com/google/benchmark/%2Bshow/4b0533b726dd8613f7d5fd0d1d044ce81f05651d/README.md?utm_source=chatgpt.com "README.md - external/github.com/google/benchmark - ..."))

## 7) å‚è€ƒå®ç°/ç°ä»£ C++ é£æ ¼ä½“ä¼š

* **robin-hood-hashing**ï¼ˆç°ä»£ C++ é£æ ¼çš„æ— åºå®¹å™¨æ›¿ä»£ï¼Œå­¦ä¹ æ¥å£/æ€§èƒ½ & é˜…è¯»ä¼˜é›…å®ç°ï¼‰ã€‚ ([GitHub](https://github.com/martinus/robin-hood-hashing?utm_source=chatgpt.com "martinus/robin-hood-hashing: Fast & memory efficient ..."))

---

## å»ºè®®å­¦ä¹ é¡ºåºï¼ˆé…ä½ â€œå¿…åšâ€äº§å‡ºï¼‰

1. **æŠŠå·¥å…·é“¾è£…å¯¹å¹¶éªŒè¯**ï¼š`gcc/clang`ã€CMakeã€`gdb`ã€`valgrind`ã€`perf`ã€‚CMake è‡ªå¸¦ `CTest`ï¼Œé¡ºä¾¿è£…ä¸Šã€‚è‹¥ `perf` æŠ¥æƒé™ï¼Œä¸´æ—¶ç”¨ï¼š`sudo sysctl kernel.perf_event_paranoid=1`ï¼ˆæˆ–å†™å…¥ `/etc/sysctl.d/*.conf` æ°¸ä¹…ç”Ÿæ•ˆï¼‰ã€‚ ([Ask Ubuntu](https://askubuntu.com/questions/1471162/how-to-change-kernel-perf-event-paranoid-settings?utm_source=chatgpt.com "How to change kernel.perf_event_paranoid settings?"))
2. **å…ˆç”¨ GoogleTest èµ·ä¸€ä¸ªæœ€å°å·¥ç¨‹**ï¼ˆå¦‚ä¸‹ CI æ¨¡æ¿ï¼‰ï¼Œè·‘é€š CTestï¼›å†åŠ  Google Benchmarkï¼Œæµ‹ä½ åé¢è¦å†™çš„â€œçº¿ç¨‹å®‰å…¨é˜Ÿåˆ—/å®šæ—¶å™¨â€ã€‚ ([google.github.io](https://google.github.io/googletest/quickstart-cmake.html?utm_source=chatgpt.com "Quickstart: Building with CMake | GoogleTest"), [GitHub](https://github.com/google/benchmark?utm_source=chatgpt.com "google/benchmark: A microbenchmark support library"))
3. **å¹¶å‘ API é€ä¸ªç»ƒ**ï¼šæŒ‰ cppreference é¡ºåºåšå°å®éªŒï¼ˆä¸åŒ `memory_order`ã€è™šå‡å”¤é†’ä¸ `while` å¾ªç¯ç­‰ï¼‰ã€‚ ([Ask Ubuntu](https://askubuntu.com/questions/309786/llvm-and-clang-installation-on-ubuntu?utm_source=chatgpt.com "llvm and clang installation on ubuntu"))
4. **è°ƒè¯•ä¸è¯Šæ–­**ï¼š
   * è§¦å‘ä¸€æ¬¡è¶Šç•Œ/Use-after-freeï¼Œç”¨ **ASan** å®šä½ã€‚ ([clang.llvm.org](https://clang.llvm.org/docs/AddressSanitizer.html?utm_source=chatgpt.com "AddressSanitizer â€” Clang 22.0.0git documentation"))
   * ç”¨ **Valgrind/Memcheck** å¤æ ¸ä¸€æ¬¡æ³„æ¼æŠ¥å‘Šã€‚ ([valgrind.org](https://valgrind.org/docs/manual/mc-manual.html?utm_source=chatgpt.com "4. Memcheck: a memory error detector"))
   * ç”¨ **strace** çœ‹ç³»ç»Ÿè°ƒç”¨åºåˆ—ï¼›ç”¨ **perf** é‡‡æ · + ç”Ÿæˆç«ç„°å›¾ï¼Œå®šä½çƒ­ç‚¹ã€‚ ([GitHub](https://github.com/strace/strace/blob/master/README.md?utm_source=chatgpt.com "strace/README.md at master"))

---

## GitHub Actionsï¼ˆå•æµ‹+åŸºå‡†ï¼‰æœ€å°å·¥ä½œæµç¤ºä¾‹

æŠŠä¸‹é¢æ–‡ä»¶ä¿å­˜ä¸º `.github/workflows/ci.yml`ï¼Œèƒ½åœ¨äº‘ç«¯ä¸€é”®ç¼–è¯‘ã€è·‘æµ‹ä¸åŸºå‡†ï¼ˆåŸºå‡†è®¾çŸ­ä¸€ç‚¹é¿å…æ—¶é•¿è¶…é™ï¼‰ã€‚

```yaml
name: ci
on:
  push: { branches: ["**"] }
  pull_request:
jobs:
  linux:
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v4
      - name: Setup C++ toolchain
        uses: aminya/setup-cpp@v1
        with:
          compiler: llvm
          cmake: true
          ninja: true
      - name: Configure
        run: cmake -S . -B build -G Ninja -DCMAKE_BUILD_TYPE=RelWithDebInfo -DBUILD_TESTING=ON
      - name: Build
        run: cmake --build build -j
      - name: Run tests (CTest)
        run: ctest --test-dir build --output-on-failure
      - name: Run microbench (short)
        run: |
          if [ -f build/bench/microbench ]; then
            build/bench/microbench --benchmark_min_time=0.05 --benchmark_repetitions=3
          fi
```

å·¥ä½œæµé‡Œ `setup-cpp` ä¸ CMake Action éƒ½æ˜¯ç¤¾åŒºå¸¸ç”¨åšæ³•ï¼›å¦‚éœ€æ›´â€œå®˜æ–¹æ¨¡æ¿â€ï¼Œå¯ç›´æ¥å‚è€ƒ GitHub çš„ CMake starter workflowsã€‚ ([GitHub](https://github.com/marketplace/actions/setup-cpp-c-c?utm_source=chatgpt.com "Setup Cpp (C++ / C) Â· Actions"))

---

## å°è´´å£«ï¼ˆå®¹æ˜“è¸©çš„ç‚¹ï¼‰

* **perf æƒé™**ï¼šé root ç¯å¢ƒä¸‹å¸¸è¢« `perf_event_paranoid` å¡ä½ï¼›ä¸´æ—¶ç”Ÿæ•ˆç”¨ `sudo sysctl kernel.perf_event_paranoid=1`ï¼Œæ°¸ä¹…å†™ `/etc/sysctl.d/*.conf`ã€‚äº‘ Runner æœ‰æ—¶è®¾ä¸º 3 æˆ– 4ï¼Œéœ€è¦é™çº§ã€‚ ([Ask Ubuntu](https://askubuntu.com/questions/1471162/how-to-change-kernel-perf-event-paranoid-settings?utm_source=chatgpt.com "How to change kernel.perf_event_paranoid settings?"))
* **ASan/UBSan ä¸ O2/O3**ï¼šå¯ä¸ä¼˜åŒ–å…±å­˜ï¼Œæ¨è `-O1/-O2 -g -fsanitize=address,undefined` å¼€å‘æœŸå¸¸å¼€ï¼›ä¸Š CI äº¦å¯ã€‚ä¾æ® Clang å®˜æ–¹æ–‡æ¡£å¯ç”¨/ç¦ç”¨ç‰¹å®šæ£€æŸ¥é¡¹ã€‚ ([clang.llvm.org](https://clang.llvm.org/docs/AddressSanitizer.html?utm_source=chatgpt.com "AddressSanitizer â€” Clang 22.0.0git documentation"))
* **Valgrind ä¸ Sanitizers äº’è¡¥**ï¼šASan æ›´å¿«ã€é€‚åˆå¼€å‘å¾ªç¯ï¼›Valgrind æ›´å…¨ã€ä½†æ…¢ã€‚äºŒè€…ç»“åˆå®šä½æ£˜æ‰‹é—®é¢˜ã€‚å®˜æ–¹æ‰‹å†Œæœ‰ Memcheck è¯¦è§£ä¸å¿«é€Ÿä¸Šæ‰‹ã€‚ ([valgrind.org](https://valgrind.org/docs/manual/mc-manual.html?utm_source=chatgpt.com "4. Memcheck: a memory error detector"))

---

å¦‚æœä½ å¸Œæœ›ï¼Œæˆ‘å¯ä»¥åŸºäºè¿™äº›èµ„æ–™ç»™ä½ æ‹‰ä¸€ä¸ª**æœ€å°å·¥ç¨‹éª¨æ¶**ï¼ˆ`src/`ã€`tests/`ã€`bench/`ã€`cmake/`ã€`CI` å…¨é…ï¼‰å¹¶å¡«ä¸Šï¼š

* `ThreadSafeQueue<T>`ï¼ˆ`mutex + condition_variable`ï¼Œæ˜ç¡®è™šå‡å”¤é†’ä¸ `while` åˆ¤ç­‰ï¼‰ï¼›
* **å°é¡¶å †å®šæ—¶å™¨**ï¼ˆ`std::chrono::steady_clock` + `priority_queue` + å”¤é†’ç­–ç•¥ï¼‰ï¼›
* GTest & Benchmark ç¤ºä¾‹ + è¿è¡Œè„šæœ¬ã€‚

è¯´ä¸€å£°ä½ çš„ç›®å½•åå¥½ï¼Œæˆ‘å°±æŒ‰ä½ çš„å£å‘³ç”Ÿæˆã€‚
